<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Clientes e pedidos</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
        background-color: #f0f2f5;
        margin: 0;
        padding: 20px;
        color: #333;
      }

      h1,
      h2 {
        color: #1c1e21;
      }

      input,
      button {
        padding: 10px 15px;
        margin: 8px 0;
        border-radius: 6px;
        border: 1px solid #ddd;
        font-size: 16px;
        transition: all 0.3s ease;
      }

      input {
        width: calc(50% - 10px);
      }

      button {
        background-color: #007bff;
        color: white;
        cursor: pointer;
        border: none;
      }

      button:hover {
        background-color: #0056b3;
        transform: translateY(-2px);
      }

      .container {
        background-color: #ffffff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      #clientes {
        list-style: none;
        padding: 0;
      }

      #clientes > li {
        background-color: #f9fafb;
        margin-top: 10px;
        padding: 15px;
        border-radius: 8px;
        border-left: 5px solid #007bff;
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        justify-content: space-between;
      }

      #clientes > li strong {
        flex-grow: 1;
        margin-right: 10px;
      }

      #clientes > li button {
        margin: 5px;
        padding: 8px 12px;
      }

      #clientes > li button:nth-of-type(1) {
        background-color: #dc3545;
      }

      #clientes > li button:nth-of-type(1):hover {
        background-color: #c82333;
      }

      ul[id^="pedidos-"] {
        padding-left: 20px;
        margin-top: 10px;
        border-top: 1px solid #eee;
      }

      ul[id^="pedidos-"] li {
        margin: 5px 0;
        color: #555;
      }
    </style>
  </head>
  <body>
    <h1>Clientes e pedidos</h1>
    <h2>Adicionar Cliente</h2>
    <input id="novoClienteNome" placeholder="nome" />
    <input id="novoClienteEmail" placeholder="Email" />
    <button onclick="adicionarCliente()">Adicionar Cliente</button>

    <h2>Lista de Clientes</h2>
    <button onclick="carregarClientes()">Carregar Clientes</button>
    <ul id="clientes"></ul>

    <script>
      const apiBase = "http://localhost:8080/api";

      // Carregar todos os clientes
      async function carregarClientes() {
        try {
          const res = await fetch(`${apiBase}/clientes`);
          const clientes = await res.json();
          const ul = document.getElementById("clientes");
          ul.innerHTML = "";

          clientes.forEach((cliente) => {
            const li = document.createElement("li");
            li.innerHTML = `
            <strong>${cliente.id} - ${cliente.nome}</strong> (${cliente.email})
            <button onclick="deletarCliente(${cliente.id})">Deletar</button>
            <button onclick="mostrarFormPedido(${cliente.id})">Adicionar Pedido</button>
            <ul id="pedidos-${cliente.id}"></ul>
          `;
            ul.appendChild(li);

            // Carregar pedidos do cliente
            carregarPedidos(cliente.id);
          });
        } catch (err) {
          alert("Erro ao carregar clientes: " + err.message);
        }
      }

      // Adicionar cliente
      async function adicionarCliente() {
        const nome = document.getElementById("novoClienteNome").value;
        const email = document.getElementById("novoClienteEmail").value;

        console.log(nome, email);
        try {
          const res = await fetch(`${apiBase}/adicionar_clientes`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ nome, email }),
          });
          if (!res.ok) throw new Error("Erro ao adicionar cliente");
          document.getElementById("novoClienteNome").value = "";
          document.getElementById("novoClienteEmail").value = "";
        } catch (err) {
          alert(err.message);
        }
      }

      // Deletar cliente
      async function deletarCliente(id) {
        try {
          await fetch(`${apiBase}/clientes/${id}`, { method: "DELETE" });
          carregarClientes();
        } catch (err) {
          alert("Erro ao deletar cliente: " + err.message);
        }
      }

      // Carregar pedidos de um cliente
      async function carregarPedidos(clienteId) {
        try {
          const res = await fetch(`${apiBase}/clientes/${clienteId}/pedidos`);
          const pedidos = await res.json();
          const ulPedidos = document.getElementById(`pedidos-${clienteId}`);
          ulPedidos.innerHTML = "";
          pedidos.forEach((p) => {
            const li = document.createElement("li");
            li.textContent = `${p.id} - ${p.descricao}`;
            ulPedidos.appendChild(li);
          });
        } catch (err) {
          console.error("Erro ao carregar pedidos:", err);
        }
      }

      // Mostrar formulário para adicionar pedido
      function mostrarFormPedido(clienteId) {
        const ulPedidos = document.getElementById(`pedidos-${clienteId}`);
        const liForm = document.createElement("li");
        liForm.innerHTML = `
        <input id="descricaoPedido-${clienteId}" placeholder="Descrição do Pedido">
        <button onclick="adicionarPedido(${clienteId})">Adicionar</button>
      `;
        ulPedidos.appendChild(liForm);
      }

      // Adicionar pedido a um cliente
      async function adicionarPedido(clienteId) {
        const descricao = document.getElementById(
          `descricaoPedido-${clienteId}`
        ).value;
        try {
          await fetch(`${apiBase}/clientes/${clienteId}/pedidos`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ descricao }),
          });
          carregarPedidos(clienteId);
        } catch (err) {
          alert("Erro ao adicionar pedido: " + err.message);
        }
      }
    </script>
  </body>
</html>
